<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Material Process Tracking System</title>

<style>
body{font-family:Arial;background:#f4f6f8;padding:10px}
.tab{padding:10px;margin:4px;background:#ccc;cursor:pointer}
.active{background:#2c3e50;color:#fff}
table{width:100%;border-collapse:collapse;background:#fff}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
button{padding:6px;width:100%}
input,select{width:100%;padding:6px}
</style>
</head>

<body>

<h2>Material Process Tracking System</h2>

<div id="tabs"></div>

<div id="content"></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxpIcBlqoiZ2Qu9wZYCAS9Fvrnqh3QE-FltGrw_2_wHSa4gwCQnf8CJsh4DZPo3L_V2/exec";

const PROCESSES = [
 "Production","Tempering","Cleaning","Vibro",
 "Plating","Deburring","Cutting","Sorting","QA","Packing"
];

let current = "Production";

const tabsDiv = document.getElementById("tabs");
const contentDiv = document.getElementById("content");

PROCESSES.forEach(p=>{
  const d=document.createElement("div");
  d.className="tab";
  d.innerText=p;
  d.onclick=()=>loadTab(p);
  tabsDiv.appendChild(d);
});

loadTab("Production");

function loadTab(stage){
  current=stage;
  [...tabsDiv.children].forEach(t=>{
    t.classList.toggle("active",t.innerText===stage);
  });

  if(stage==="Production") renderProduction();
  else renderProcess(stage);
}

function renderProduction(){
contentDiv.innerHTML=`
<h3>Production Release</h3>
<input id="part" placeholder="Part No">
<input id="wo" placeholder="Work Order No">
<input id="mc" placeholder="Machine No">
<input id="qty" placeholder="Quantity">
<input id="plant" placeholder="Plant">
<input id="shift" placeholder="Shift">
<input id="grn" placeholder="GRN / Coil No">

<select id="next">
${PROCESSES.slice(1).map(p=>`<option>${p}</option>`).join("")}
</select>

<select id="ht"><option>Bin</option><option>Bag</option></select>
<input id="hq" placeholder="Qty per Bin/Bag">
<input id="hc" placeholder="No of Bins/Bags">

<button onclick="release()">Release</button>
`;
}

function release(){
  const payload={
    part_no:part.value,
    work_order_no:wo.value,
    machine_no:mc.value,
    quantity:qty.value,
    plant:plant.value,
    shift:shift.value,
    grn_coil_no:grn.value,
    from_process:"Production",
    to_process:next.value,
    handling_type:ht.value,
    handling_qty:hq.value,
    handling_count:hc.value,
    status:"RELEASED",
    operator:"Production",
    remarks:""
  };
  fetch(SCRIPT_URL,{method:"POST",mode:"no-cors",body:JSON.stringify(payload)});
  alert("Released");
}

function renderProcess(stage){
fetch(`${SCRIPT_URL}?stage=${stage}`)
.then(r=>r.json())
.then(rows=>{
let html=`<h3>${stage}</h3><table>
<tr><th>Part</th><th>Qty</th><th>GRN</th><th>Next</th><th>Remark</th><th>Action</th></tr>`;
rows.forEach(r=>{
  const next=PROCESSES[PROCESSES.indexOf(stage)+1]||"Packing";
  html+=`
<tr>
<td>${r[1]}</td>
<td>${r[4]}</td>
<td>${r[7]}</td>
<td>${next}</td>
<td><input id="rm_${r[7]}"></td>
<td>
<button onclick="ok('${stage}','${next}','${r[7]}',${r[4]})">OK</button>
<button onclick="ng('${stage}','${r[7]}',${r[4]})">NG</button>
</td>
</tr>`;
});
contentDiv.innerHTML=html+"</table>";
});
}

function ok(from,to,grn,qty){
send(from,to,grn,qty,"OK");
}

function ng(from,grn,qty){
send(from,from,grn,qty,"NG");
}

function send(from,to,grn,qty,status){
const payload={
  part_no:"",
  work_order_no:"",
  machine_no:"",
  quantity:qty,
  plant:"",
  shift:"",
  grn_coil_no:grn,
  from_process:from,
  to_process:to,
  handling_type:"",
  handling_qty:"",
  handling_count:"",
  status:status,
  operator:from,
  remarks:document.querySelector(`#rm_${grn}`).value
};
fetch(SCRIPT_URL,{method:"POST",mode:"no-cors",body:JSON.stringify(payload)});
loadTab(current);
}
</script>

</body>
</html>
