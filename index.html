<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Material Process Tracking System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial; background:#f2f2f2; padding:10px; }
h2 { margin:10px 0; }
.tabs button {
  width:100%;
  padding:8px;
  margin:2px 0;
  border:none;
  background:#ccc;
  cursor:pointer;
}
.tabs button.active {
  background:#2c3e50;
  color:white;
}
.tab {
  display:none;
  background:white;
  padding:10px;
  margin-top:10px;
}
input, select, button {
  width:100%;
  padding:6px;
  margin:4px 0;
}
button.action {
  background:#2c3e50;
  color:white;
}
table {
  width:100%;
  border-collapse:collapse;
}
th, td {
  border:1px solid #aaa;
  padding:6px;
  text-align:center;
}
</style>
</head>

<body>

<h2>Material Process Tracking System</h2>

<div class="tabs">
  <button class="active" onclick="openTab('production',this)">Production</button>
  <button onclick="openTab('tempering',this)">Tempering</button>
  <button onclick="openTab('qa',this)">QA</button>
  <button onclick="openTab('packing',this)">Packing</button>
</div>

<!-- ================= PRODUCTION ================= -->
<div id="production" class="tab" style="display:block">
<h3>Production Release</h3>

<input id="part" placeholder="Part No">
<input id="workOrder" placeholder="Work Order No">
<input id="machine" placeholder="Machine No">
<input id="qty" type="number" placeholder="Quantity">
<input id="plant" placeholder="Plant">
<input id="shift" placeholder="Shift">
<input id="grncoil" placeholder="GRN / Coil No">

<label>Next Process</label>
<select id="nextProcess">
  <option>Tempering</option>
  <option>QA</option>
</select>

<label>Handling Type</label>
<select id="handlingType">
  <option>Bin</option>
  <option>Bag</option>
</select>

<input id="handlingQty" placeholder="Qty per Bin / Bag">
<input id="handlingCount" placeholder="No. of Bins / Bags">

<button class="action" onclick="releaseProduction()">Release</button>
</div>

<!-- ================= TEMPERING ================= -->
<div id="tempering" class="tab">
<h3>Tempering</h3>
<table id="temperingTable"></table>
</div>

<!-- ================= QA ================= -->
<div id="qa" class="tab">
<h3>QA</h3>
<table id="qaTable"></table>
</div>

<!-- ================= PACKING ================= -->
<div id="packing" class="tab" style="display:block">
<h3>Packing (Pending)</h3>
<table id="packingTable"></table>
</div>

<script>
/* ðŸ”´ APPS SCRIPT URL */
const API_URL =
"https://script.google.com/macros/s/AKfycbwkqqSuT0h-59YaTWueNI05qExZ5w8BZI-E1R2LKMK43-7pedBEmCYb3BB_aE6zXi8h/exec";

/* TAB SWITCH */
function openTab(id, btn) {
  document.querySelectorAll('.tab').forEach(t => t.style.display="none");
  document.getElementById(id).style.display="block";
  document.querySelectorAll('.tabs button').forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");

  if (id==="tempering") loadProcess("Tempering","temperingTable");
  if (id==="qa") loadProcess("QA","qaTable");
  if (id==="packing") loadProcess("Packing","packingTable");
}

/* PRODUCTION RELEASE */
function releaseProduction() {
  fetch(API_URL,{
    method:"POST",
    mode:"no-cors",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      current_process:"Production",
      next_process:nextProcess.value,
      part_no:part.value,
      work_order_no:workOrder.value,
      machine_no:machine.value,
      quantity:qty.value,
      plant:plant.value,
      shift:shift.value,
      grn_coil_no:grncoil.value,
      handling_type:handlingType.value,
      handling_qty:handlingQty.value,
      handling_count:handlingCount.value,
      status:"OK",
      operator:"Production",
      remarks:""
    })
  });
  alert("Released");
}

/* LOAD DATA */
function loadProcess(process, tableId) {
  fetch(API_URL+"?process="+process)
    .then(r=>r.json())
    .then(rows=>{
      const table=document.getElementById(tableId);
      table.innerHTML=
        "<tr><th>Part</th><th>Qty</th><th>GRN/Coil</th><th>Action</th></tr>";

      rows.forEach(r=>{
        const tr=document.createElement("tr");
        tr.innerHTML=`
          <td>${r.Part_No}</td>
          <td>${r.Quantity}</td>
          <td>${r.GRN_Coil_No}</td>
          <td>
            <select class="nextP">
              ${process==="QA" ? "<option>Packing</option>" : "<option>QA</option>"}
            </select>
            <input class="remark" placeholder="Remark mandatory">
            <button class="action" onclick="processOK(this,'${process}')">OK</button>
          </td>`;
        table.appendChild(tr);
      });
    });
}

/* OK ACTION */
function processOK(btn,current){
  const row=btn.parentElement.parentElement;
  const part=row.children[0].innerText;
  const qty=row.children[1].innerText;
  const grn=row.children[2].innerText;
  const next=row.querySelector(".nextP").value;
  const remark=row.querySelector(".remark").value;

  if(!remark){ alert("Remark mandatory"); return; }

  fetch(API_URL,{
    method:"POST",
    mode:"no-cors",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      current_process:current,
      next_process:next,
      part_no:part,
      quantity:qty,
      grn_coil_no:grn,
      status:"OK",
      operator:current,
      remarks:remark
    })
  });

  row.remove();
}
</script>

</body>
</html>
